@page
@model Ass2_WebRazor.Pages.Authors.CreateModel

<h1>Create New Author</h1>

<form id="createAuthorForm">
    <div class="form-group">
        <label for="authorlastname">Last Name</label>
        <input type="text" class="form-control" id="authorlastname" name="authorlastname" required>
    </div>
    <div class="form-group">
        <label for="authorfirstname">First Name</label>
        <input type="text" class="form-control" id="authorfirstname" name="authorfirstname" required>
    </div>
    <div class="form-group">
        <label for="authorphone">Phone</label>
        <input type="text" class="form-control" id="authorphone" name="authorphone">
    </div>
    <div class="form-group">
        <label for="authoraddress">Address</label>
        <input type="text" class="form-control" id="authoraddress" name="authoraddress">
    </div>
    <div class="form-group">
        <label for="authorcity">City</label>
        <input type="text" class="form-control" id="authorcity" name="authorcity">
    </div>
    <div class="form-group">
        <label for="authorstate">State</label>
        <input type="text" class="form-control" id="authorstate" name="authorstate">
    </div>
    <div class="form-group">
        <label for="authorzip">Zip</label>
        <input type="text" class="form-control" id="authorzip" name="authorzip">
    </div>
    <div class="form-group">
        <label for="authoremail">Email</label>
        <input type="email" class="form-control" id="authoremail" name="authoremail" required>
    </div>
    <button type="submit" class="btn btn-primary">Submit</button>
</form>

@section scripts {
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                document.getElementById("createAuthorForm").addEventListener("submit", function (event) {
                    event.preventDefault();
                    const form = event.target;
                    const formData = new FormData(form);
                    const jsonData = {};
                    formData.forEach((value, key) => { jsonData[key] = value });
                    fetch('https://localhost:7027/api/Authors', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(jsonData)
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Handle success
                        console.log(data);
                        alert('Author created successfully!');
                        // Redirect or perform any other action after successful creation
                        window.location.href = '/Authors/Index';
                    })
                    .catch(error => {
                        // Handle error
                        console.error('There was a problem with your fetch operation:', error);
                        alert('Failed to create author. Please try again.');
                    });
                });
            });
        </script>
}